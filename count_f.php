<?php
$IP = $_SERVER['REMOTE_ADDR'];
$time = date("H:i:s");
$words = "1";
$referer = isset($_SERVER['HTTP_REFERER']) ? strtolower($_SERVER['HTTP_REFERER']) : 'Реферера нету...';

$bots = array("5.255.210.93", "5.255.253.17", "37.9.118.28","37.9.118.29", "42.236.54.2", "42.236.99.65", "42.236.99.218", "46.229.168.136", 
"46.229.168.139", "54.37.234.58", "54.37.234.59", "66.249.64.25", "66.249.64.152", "66.249.66.8", "66.249.66.40", "66.249.90.111", "66.249.90.113",
 "77.122.28.197", "87.250.246.129", "93.158.155.137", "93.158.166.9", "95.108.129.196", "95.108.129.207", "95.108.129.196", "95.108.129.200", 
 "95.108.158.234", "95.108.181.80", "95.108.241.251", "95.163.255.244", "130.193.51.55", "141.8.132.32","141.8.142.6", "141.8.142.37", 
 "141.8.142.38", "141.8.142.74", "141.8.142.98","141.8.142.111",  "141.8.142.147", "141.8.142.160", "141.8.183.36", "157.55.32.112", 
 "157.55.33.31", "176.99.6.254", "178.154.165.250", "178.154.171.30", "178.154.171.60", "178.154.200.21", "178.154.200.65", "178.154.244.31",
 "178.154.224.114", "178.154.224.118", "178.154.246.7", "188.40.102.169", "207.46.13.107", "213.180.206.197", "213.180.203.41", "213.180.203.66",
 "213.180.206.205");
	foreach ($bots as &$i) {
		    if ($i == $IP){
		  	 	return;
		  	 	}
			}
unset($i);

 $searchEngines = array(

        'google.' => array('q', 'prev'),

        'yandex.' => array('text', 'query')

    );
 $ref = parse_url(urldecode($referer));

    $site = $ref['host'];

    $text = $ref['query'];

    parse_str($text, $arr);

    foreach ($searchEngines as $key => $value) {

        if (substr_count($site, $key)) {

            foreach ($arr as $k => $v) {

                if (is_array($value)) {

                if (in_array ("$k", $value)) {

                    $words = $v;

                break;

                }

            }

            elseif ("$k" == $value) {

                $words = $v;

                break;

            }

            else {

                $words = "0";

                break;

                }

            }

            break;

        }

    }

		$fd = fopen( "count.txt","a" );
		fwrite($fd, $IP);
		fwrite($fd, "	$time $words \r\n");
		fclose( $fd );

echo "		$time";

?>
